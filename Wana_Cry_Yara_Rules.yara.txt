import "pe"

rule Wana_Cry_Executable
{
    meta:

        description = "YARA rule for Wana Cry ransomeware executable"
        author = "0xNumb3rs"
    
    strings:

    $a_sha256 = "24D004A104D4D54034DBCFFC2A4B19A11F39008A575AA614EA04703480B1022C"
    $it_is_a_pe = "MZ"
    $a_string = "C:\\%s\\qeriuwjhrf"
    $a_string2 = "C:\\%s\\%s"
    $a_string3 = "http://www.iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com"
    $a_string4 = "cmd.exe /c %s"
    $a_string5 = "icacls . /grant Everyone:F /T /C /Q"
    $a_string6 = "CryptEncrypt"
    $a_string7 = "CryptDestroyKey"
    $a_string8 = "CryptImportKey"
    $a_string9 = "CryptAcquireContextA"
    $a_string10 = "Cryp*key"

    $a_hex =  "55 8B EC 6A FF 68 A0 A1 40 00 68 A2 9B 40 00 64 A1 00 00 00 00 50 64 89 25 00 00 00 00 83 EC 68 53"  //Entry point

    $wna_cry = "wcry"
    $wna_cry_at = "WNcry@"



    condition:

        3 of ($a_string*,$a_string2,$a_string3,$a_string4,$a_string5,$a_string6,$a_string7,$a_string8,a_string9,$a_string10) and $a_sha256 and $a_hex            //This command only allows to check the included string and hex
        and ([pe.imphash() == e6d8aadcedbf48e2c4e76d589a1c8b55]) or any of ($wna_cry*, $wna_cry_at)


    

}